<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="de">
<head th:insert="~{fragments :: html_head}"></head>
<body class="nav-fixed">
<nav th:insert="~{fragments :: topnav}"></nav>
<div id="layoutSidenav">
    <div id="layoutSidenav_nav" th:insert="~{fragments :: sidebar}"></div>
    <div id="layoutSidenav_content">
        <main>

            <div th:replace="~{person/fragments/personFragments :: header (${person.getName()})}"></div>

            <div class="container-fluid">
                <div class="row g-3 align-items-stretch mb-3">

                    <!-- LINKER BEREICH (unverändert, Fachlichkeit bleibt erhalten) -->
                    <aside class="col-lg-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <!-- Profil -->
                                <div class="d-flex align-items-center gap-3">
                                    <img th:src="${person.getImgAddress()}" alt="Jerome Bell" class="rounded-circle"
                                         width="64" height="64">
                                    <div>
                                        <h5 class="card-title mb-0" th:text="${person.getName()}"></h5>
                                        <div class="text-warning small">
                                            <i class="bi bi-star-fill"></i>
                                            <span th:text="${person.getRank().getName()}"></span>
                                        </div>
                                        <div class="text-muted small" th:text="${person.getTenant().getName()}"></div>
                                    </div>
                                </div>

                                <!-- Job Info -->
                                <div class="card bg-green-soft border-0 mt-4">
                                    <div class="card-body p-3">
                                        <div class="fw-bold">Compliance Status</div>
                                        <div class="mt-3">
                                            <div class="d-flex justify-content-between small text-muted mb-1">
                                                <span>Stage</span><span class="text-green">Complaint</span>
                                            </div>
                                            <div class="progress" style="height: 6px;">
                                                <div class="progress-bar bg-green" style="width: 100%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Aktionen -->
                                <div class="d-flex gap-2 mt-3">
                                    <button class="btn btn-primary flex-grow-1">Vorgang anlegen</button>
                                    <button class="btn btn-outline-black"><i data-feather="clock"></i></button>
                                </div>

                                <!-- Person -->
                                <div class="mt-4">
                                    <div class="text-uppercase small fw-bold text-muted mb-2">Person</div>
                                    <ul class="list-unstyled mb-0">
                                        <li class="mb-2"><i class="text-muted me-2 mdi mdi-map-marker"></i>
                                            <span th:text="${person.getType().toString()}"></span>
                                        </li>
                                        <li class="mb-2"><i class="text-muted me-2 mdi mdi-strategy"></i>
                                            <a th:href="'/personal?q=profil&s=overview&id=' + ${principalPerson.get().getId()}"
                                               th:if="${principalPerson.isPresent()}"
                                               th:text="${principalPerson.get().getReadName()}"></a>
                                        </li>
                                    </ul>
                                </div>

                                <!-- Kontakt -->
                                <div class="mt-4">
                                    <div class="text-uppercase small fw-bold text-muted mb-2">Kontakt</div>
                                    <ul class="list-unstyled mb-0">
                                        <li class="mb-2"><i class="text-muted me-2 mdi mdi-map-marker"></i>
                                            <span th:text="${person.getAddress()}"></span>
                                            <span th:if="${person.getAddress().replace(' ','').isEmpty()}"
                                                  th:text="'Nicht gesetzt'" class="text-red"></span>
                                        </li>
                                        <li class="mb-2"><i class="text-muted me-2 mdi mdi-email"></i>
                                            <a th:unless="${person.getEmail() == null}"
                                               th:href="'mailto:'+${person.getEmail()}"
                                               th:text="${person.getEmail()}"></a>
                                            <span th:if="${person.getEmail() == null}" th:text="'Nicht gesetzt'"
                                                  class="text-red"></span>
                                        </li>
                                        <li class="mb-2"><i class="text-muted me-2 mdi mdi-phone-classic"></i>
                                            <a th:href="'tel:' + ${person.getPhone()}"
                                               th:text="${person.getPhone()}"></a>
                                            <span th:if="${person.getPhone() == null}" th:text="'Nicht gesetzt'"
                                                  class="text-red"></span>
                                        </li>
                                        <li class="mb-2"><i class="text-muted me-2 mdi mdi-phone"></i>
                                            <a th:href="'tel:' + ${person.getMobile()}"
                                               th:text="${person.getMobile()}"></a>
                                            <span th:if="${person.getMobile() == null}" th:text="'Nicht gesetzt'"
                                                  class="text-red"></span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </aside>

                    <!-- RECHTER BEREICH -->
                    <main class="col-lg-10">
                        <div class="card h-100">
                            <div class="card-header border-0 bg-white">
                                <div th:replace="~{person/fragments/personFragments :: nav(${step}, ${person.getId()})}"></div>
                            </div>
                            <div class="card-body">

                                <!-- Bestehende Infos/Workflow-Tabelle (unverändert) -->
                                <div class="mb-3">
                                    <div class="overflow-auto" style="max-height: 500px!important;">
                                        <table class="table table-sm table-hover table-bordered">
                                            <thead>
                                            <tr>
                                                <th></th>
                                                <th>Beschreibung</th>
                                                <th>Kategorie</th>
                                                <th>Status</th>
                                                <th>Bearbeiter*in</th>
                                                <th>Ersteller*in</th>
                                                <th>Manager*in</th>
                                                <th>Anhänge</th>
                                                <th>Vermerke</th>
                                                <th>Datum</th>
                                                <th>Letztes Update</th>
                                                <th>Frist</th>
                                                <th>Compliance</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr th:each="w : ${workflows}" th:class="${w.state().getBgColor()}">
                                                <td class="text-center"><span class="text-green mdi mdi-lightning-bolt"></span></td>
                                                <td><a th:text="${w.workflowName()}" th:href="'/workflow?q=info&id=' + ${w.workflowId()}"></a></td>
                                                <td th:text="${w.category().label}"></td>
                                                <td th:text="${w.state().label}"></td>
                                                <td th:text="${w.editor()}"></td>
                                                <td th:text="${w.creator()}"></td>
                                                <td th:text="${w.manager()}"></td>
                                                <td th:text="${w.attachments()}"></td>
                                                <td th:text="${w.notes()}"></td>
                                                <td th:text="${w.creationDate().getGermanDate()}"></td>
                                                <td th:text="${w.modificationDate().getGermanDate()}"></td>
                                                <td th:text="${w.endDate().getGermanDate()}"></td>
                                                <td>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="check1" name="option1" value="something" checked style="pointer-events: none">
                                                        <label class="form-check-label" for="check1"></label>
                                                    </div>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>

                </div>

                <div th:replace="~{person/fragments/personDocumentsFragment :: documents(${person}, ${files}, ${personHelper})}"></div>
                <div th:replace="~{person/fragments/personLiturgyFragment :: liturgy(${person}, ${now}, ${persons}, ${liturgieViews}, ${startDate}, ${endDate})}"></div>
                <div th:replace="~{person/fragments/personSettingsFragment :: settings(${person})}"></div>

            </div>

        </main>
        <footer th:insert="~{fragments :: footer}"></footer>
    </div>
</div>
<div th:insert="~{fragments :: script}"></div>

<!-- Lokale Person-JS (falls bereits angelegt: Toast/Collapses/Ajax) -->
<script src="/js/person/base/person-toast.js"></script>
<script src="/js/person/base/person-collapses.js"></script>
<script src="/js/person/base/person-ajax.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (window.initPersonAjaxForms) initPersonAjaxForms();
    });
</script>
</body>
</html>
