<!-- fragments :: toasts -->
<div th:fragment="toasts">
    <!-- Toast container (unten rechts) -->
    <div id="toast-stack" style="position: fixed; bottom: 1rem; right: 1rem; z-index: 1080;"></div>

    <script>
        window.CMSToast = (function () {
            const stack = () => document.getElementById('toast-stack');

            function show(type, title, message) {
                const toastEl = document.createElement('div');
                toastEl.className = 'toast';
                toastEl.setAttribute('role', 'alert');
                toastEl.setAttribute('aria-live', 'assertive');
                toastEl.setAttribute('aria-atomic', 'true');
                toastEl.setAttribute('data-bs-delay', '3000');
                toastEl.setAttribute('data-bs-autohide', 'true');

                toastEl.innerHTML = `
                  <div class="toast-header">
                      <i data-feather="${type === 'success' ? 'check-circle' : 'x-circle'}"
                         class="me-2 ${type === 'success' ? 'text-success' : 'text-danger'}"></i>
                      <strong class="me-auto">${title || (type === 'success' ? 'Erfolgreich' : 'Fehlgeschlagen')}</strong>
                      <small class="text-muted ms-2">gerade eben</small>
                      <button type="button" class="btn-close ms-2 mb-1" data-bs-dismiss="toast" aria-label="Close"></button>
                  </div>
                  <div class="toast-body">${message || ''}</div>
                `;

                stack().appendChild(toastEl);

                // Feather Icons neu laden
                if (window.feather) feather.replace();

                // Bootstrap Toast initialisieren und anzeigen
                const toast = new bootstrap.Toast(toastEl);
                toast.show();

                // nach Ausblenden aus dem DOM entfernen
                toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
            }

            return {
                success: (msg, title) => show('success', title, msg),
                error:   (msg, title) => show('error', title, msg)
            }
        })();
    </script>
</div>
